---
title: Nim 游戏及部分变种
mathjax: true
date: 2025-07-28T22:32:47.987+0800
categories:
  - Math
tags:
  - games
---

### Nim 游戏

一般来说，Nim 游戏的规则如下：

> 有 $n$ 堆石子（排成一行），第 $i$ 堆有 $a\_i$ 个，两名玩家轮流取走任意一堆的任意（正整数）个石子。
>
> 无法行动的玩家失败（经典规则下，即拿走最后一枚石子的玩家获胜）。

显然对于一堆石子的情形，其 SG 函数值为 $a\_i$；由 SG 定理，整局游戏的 SG 函数值为 $\begin{aligned}\bigoplus\_{i=1}^{n} a\_i\end{aligned}$。

SG 函数值非零时先手必胜（N 态），SG 函数值为零时后手必胜（先手必败，P 态）。

### 变种 1：每次只能从最左侧或最右侧取

TODO

### 变种 2：每次只能从最多的一堆中取，并列时任选

设初始状态为 $A=\left\\{a\_1,a\_2,\ldots,a\_{n-1},a\_{n}\right\\}$，不妨令序列不降。

* 若 $a\_n \gt a\_{n-1}$，则 $B=\left\\{a\_1,a\_2,\ldots,a\_{n-1},a\_{n-1}\right\\}$ 为后继状态之一。
  + 若 $B$ 为 P 态，则 $A$ 已经为 N 态；
  + 若 $B$ 为 N 态，则其后继状态存在 P 态，又注意到 $B$ 的后继均为 $A$ 的后继，因此 $A$ 为 N 态。
* 假设石子最多的堆共有 $m$ 堆，由上述结论，显然 $m$ 为 $2$ 的倍数时为 P 态，否则为 N 态。

### 变种 3：每次只能从最少的一堆中取，并列时任选

1. $n=1$ 时先手必胜（N 态）。
2. 若不存在 $a\_i\gt 1$，则当且仅当 $2\mid n$ 时为 P 态，否则为 N 态。
3. 若 $n\gt 1$ 且存在 $a\_i\gt 1$，设有且仅有 $m$ 堆满足 $a\_i=1$，则当且仅当 $2\mid m$ 时为 N 态，否则为 P 态。

{% note Proof fold %}

前两种情况显然，这里只讨论情况 3。

首先，显然 $2\mid m$ 的情形与 $m=0$ 的情形等价；否则与 $m=1$ 的情形等价。

其次，以 $m=1$ 为例，先手只能将 $m=0$ 的情形交给对手，而对手可以将 $m=1$ 的情形交还，直到 $n=1$，此时轮到对手，故 $m=1$ 为 P 态。

{% endnote %}

### 变种 4：先手可以任选一堆，今后不能选择与上一堆相同的

与 Nim 游戏无本质区别，留给读者自证。

### 变种 5：先手可以任选一堆，今后必须选择与上一堆相邻的

TODO

### 变种 6：先手可以任选一堆，今后必须选择与上一堆相同的，除非已经取尽

TODO

### 变种 7：每次取完后，可以立刻从另一堆中取走同样多的石子

TODO

### 变种 8：每次取石子的数量上限为 3

考虑每堆石子的 SG 函数值，显然为 $a\_i\bmod 3$。

因此整局游戏的 SG 函数值为 $\begin{aligned}S=\bigoplus\_{i=1}^{n} \left(a\_i\bmod 3\right)\end{aligned}$。

### 变种 9：无法行动的玩家胜利

即 Anti-Nim 游戏，其他反常游戏的做法类似。

存在结论：

{% raw %}

<ol type="A">
 <li>若 $\forall a_i=1$，则局面为 N 态当且仅当共有偶数堆石子；</li>
 <li>若 $\exists a_i\gt 1$，则局面为 N 态当且仅当 $\begin{aligned}S=\bigoplus_{i=1}^{n} a_i\gt 0\end{aligned}$。</li>
</ol>

{% endraw %}

{% note Proof fold %}

+ 局面 A 显然。
+ 对于局面 B，分 3 种情况讨论：
  + （B0）只存在一个 $a\_i\gt 1$，此时显然先手必胜（N 态），且 $S\ne 0$。
  + （B1）至少 2 个 $a\_i\gt 1$，且 $S\ne 0$。
  + （B2）至少 2 个 $a\_i\gt 1$，且 $S=0$。
  + 对于局面 B1，由 Nim 游戏结论，显然**一定**可以转移到 B2。
  + 对于局面 B2，显然或者转移到 B0，或者转移到 B1，且有时只能转移到 B0。
  + 综合以上两条结论，不难得出原命题成立。

{% endnote %}

### 变种 10：游戏中有且只有一次跳过的机会

TODO

### 变种 11：每次玩家取完后，若存在其他取法，对手可以要求更换方法，每轮限一次

TODO
