---
title: WQS 二分优化 DP
mathjax: true
date: 2025-08-11 02:08:43
categories:
  - OI
tags:
  - Dynamic-Programming
---

WQS 二分，在不同的文章里，也常称作带权二分、凸优化 DP、凸完全单调性 DP、Lagrange 乘子法等，在国外也称作 Aliens Trick。它最早由王钦石（wqs）在《浅析一类二分方法》一文中总结。

WQS 二分的典型特征是限制“恰好取 $K$ 个”的最优化问题。

应用 WQS 二分要求函数具有凸性；例如，设“从 $n$ 个中恰好取 $k$ 个”的最优解为 $w(n,k)$，则一般要求 $w(n,k)$ 关于 $k$ 是凸的。

## 二分

假如将 $k$ 作为 $x$ 轴，$w(n,k)$ 作为 $y$ 轴，则函数图像可能形如：

<img src="/image/wqs.svg" alt="wqs" style="background: white;">

这里使用下凸函数为例。

我们其实不知道这个函数具体长什么样子，只知道它是凸的，我们尝试使用一条直线去切这个凸壳，检查切点的位置：

+ 若切点的横坐标恰为所求的 $k$，则问题解决；
+ 否则，由于凸壳的斜率是单调的，因此可以二分斜率。

可以结合上图理解。

现在的问题是，如何求出切点的位置。

考虑这个东西的含义，假设斜率为 $k$ 的直线 $y=kx+b$ 恰好经过点 $(m,w(n,m))$，则截距 $b=w(n,m)-km$。

而 $b=w(n,m)-km$ 可以理解为每次选择都花费了 $k$ 的代价。

注意到直线切到凸壳时截距取最小值，因此在做完转化后求一个不带限制的最小化 DP 即可。
